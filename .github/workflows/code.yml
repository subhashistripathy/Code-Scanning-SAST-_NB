name: Snyk SCA â€“ No Block

on:
  push:
  pull_request:

jobs:
  snyk-sca:
    runs-on: ubuntu-latest
    permissions:
      contents: read
      security-events: write

    steps:
      - uses: actions/checkout@v4

      - uses: snyk/actions/setup@master

      - name: Install dependencies (optional)
        run: |
          if [ -f requirements.txt ]; then
            pip install -r requirements.txt || true
          fi

      - name: Run Snyk SCA (no-block) + force SARIF
        run: |
          echo "Running Snyk scan..."
          snyk test --all-projects --sarif-file-output=snyk-sca.sarif || echo "Snyk failed but continuing"

          # If SARIF was not created, create an empty valid file
          if [ ! -f snyk-sca.sarif ]; then
            echo "Creating fallback SARIF file"
            echo '{ "version":"2.1.0","runs":[] }' > snyk-sca.sarif
          fi

          ls -lh snyk-sca.sarif
        env:
          SNYK_TOKEN: c80a2012-bb87-4482-beb5-399c664f183d

      - name: Upload SARIF
        uses: github/codeql-action/upload-sarif@v4
        with:
          sarif_file: snyk-sca.sarif
